<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bitcoin-miner</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <header>
        <h1>Bitcoin Miner Tycoon 2025</h1>
        <div id="user-status"></div>
    </header>
    <main>
        <p>Zostań potentatem kryptowalut! Klikaj, aby kopać Bitcoiny i ulepszać swoją koparkę. Czy zostaniesz milionerem?</p>
        
        <div class="miner-container">
            <div class="stats">
                <p>Saldo: <span id="balance">0.00000000</span> BTC</p>
                <p>Moc na klik: <span id="power">1</span> Satoshi</p>
            </div>
            
            <div class="click-area">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/46/Bitcoin.svg/1200px-Bitcoin.svg.png" alt="Bitcoin" id="bitcoin-img">
                <p id="click-feedback">+1</p>
            </div>

            <div class="upgrades">
                <h3>Ulepszenia</h3>
                <button id="upgrade-power-btn">Ulepsz moc kliknięcia (Koszt: <span id="upgrade-power-cost">100</span> Satoshi)</button>
                <button id="upgrade-autoclicker-btn">Kup Autoclicker (Koszt: <span id="autoclicker-cost">5000</span> Satoshi)</button>
                <p>Autoclicker: <span id="autoclicker-level">0</span> (0 Satoshi/s)</p>
            </div>
        </div>

        <a href="../index.html">Powrót do strony głównej</a>
    </main>
    <script>
        // Wait for auth.js to load
        document.addEventListener('DOMContentLoaded', () => {
            // Get current user session
            const session = JSON.parse(sessionStorage.getItem('forum_session'));
            if (!session) {
                window.location.href = '../login.html';
                return;
            }

            const USERS_KEY = 'forum_users';
            const getUsers = () => JSON.parse(localStorage.getItem(USERS_KEY)) || [];
            const saveUsers = (users) => localStorage.setItem(USERS_KEY, JSON.stringify(users));

            const currentUser = getUsers().find(u => u.username === session.username);
            if (!currentUser) {
                alert('Błąd: Użytkownik nie znaleziony.');
                window.location.href = '../login.html';
                return;
            }

            let balance = currentUser.satoshiBalance || 0; // in Satoshis
            let power = currentUser.minerPower || 1;
            let upgradePowerCost = currentUser.upgradePowerCost || 100;
            let autoclickerLevel = currentUser.autoclickerLevel || 0;
            let autoclickerCost = currentUser.autoclickerCost || 5000;
            let autoclickerPower = currentUser.autoclickerPower || 0;

            const balanceEl = document.getElementById('balance');
            const powerEl = document.getElementById('power');
            const bitcoinImg = document.getElementById('bitcoin-img');
            const clickFeedbackEl = document.getElementById('click-feedback');
            
            const upgradePowerBtn = document.getElementById('upgrade-power-btn');
            const upgradePowerCostEl = document.getElementById('upgrade-power-cost');

            const upgradeAutoclickerBtn = document.getElementById('upgrade-autoclicker-btn');
            const autoclickerCostEl = document.getElementById('autoclicker-cost');
            const autoclickerLevelEl = document.getElementById('autoclicker-level');

            const SATOSHIS_IN_BTC = 100_000_000;

            function updateUserData() {
                const users = getUsers();
                const userIndex = users.findIndex(u => u.username === session.username);
                if (userIndex !== -1) {
                    users[userIndex].satoshiBalance = balance;
                    users[userIndex].minerPower = power;
                    users[userIndex].upgradePowerCost = upgradePowerCost;
                    users[userIndex].autoclickerLevel = autoclickerLevel;
                    users[userIndex].autoclickerCost = autoclickerCost;
                    users[userIndex].autoclickerPower = autoclickerPower;
                    saveUsers(users);
                }
            }

            function updateDisplay() {
                balanceEl.textContent = (balance / SATOSHIS_IN_BTC).toFixed(8);
                powerEl.textContent = power;
                upgradePowerCostEl.textContent = upgradePowerCost;
                autoclickerCostEl.textContent = autoclickerCost;
                autoclickerLevelEl.textContent = `${autoclickerLevel} (${autoclickerPower} Satoshi/s)`;
            }

            bitcoinImg.addEventListener('click', () => {
                balance += power;
                updateUserData();
                updateDisplay();
                
                // Animation
                bitcoinImg.classList.add('clicked');
                clickFeedbackEl.textContent = `+${power}`;
                clickFeedbackEl.classList.add('show');

                setTimeout(() => {
                    bitcoinImg.classList.remove('clicked');
                }, 100);
                setTimeout(() => {
                    clickFeedbackEl.classList.remove('show');
                }, 500);
            });

            upgradePowerBtn.addEventListener('click', () => {
                if (balance >= upgradePowerCost) {
                    balance -= upgradePowerCost;
                    power += Math.ceil(power * 0.5);
                    upgradePowerCost = Math.ceil(upgradePowerCost * 1.8);
                    updateUserData();
                    updateDisplay();
                } else {
                    alert('Za mało Satoshi!');
                }
            });

            upgradeAutoclickerBtn.addEventListener('click', () => {
                if (balance >= autoclickerCost) {
                    balance -= autoclickerCost;
                    autoclickerLevel++;
                    autoclickerPower = Math.ceil(autoclickerLevel * autoclickerLevel * 2.5);
                    autoclickerCost = Math.ceil(autoclickerCost * 2.5);
                    updateUserData();
                    updateDisplay();
                } else {
                    alert('Za mało Satoshi!');
                }
            });

            setInterval(() => {
                if (autoclickerPower > 0) {
                    balance += autoclickerPower;
                    updateUserData();
                    updateDisplay();
                }
            }, 1000);

            updateDisplay();
        });
    </script>
    <script src="../auth.js"></script>
    <style>
        .miner-container { text-align: center; }
        .stats { margin-bottom: 20px; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 16px; padding: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); }
        .click-area { position: relative; margin-bottom: 20px; }
        #bitcoin-img { width: 150px; cursor: pointer; transition: transform 0.1s ease; }
        #bitcoin-img.clicked { transform: scale(0.9); }
        #click-feedback { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 2em; color: #FFD700; opacity: 0; transition: opacity 0.5s ease, transform 0.5s ease; pointer-events: none; }
        #click-feedback.show { opacity: 1; transform: translate(-50%, -150%); }
        .upgrades { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 16px; padding: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); }
        .upgrades button { display: block; width: 100%; padding: 12px 20px; margin-bottom: 10px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; color: #fff; cursor: pointer; border-radius: 8px; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); }
        .upgrades button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5); }
    </style>
</body>
</html>